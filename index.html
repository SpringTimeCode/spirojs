<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <title>Spiro JS</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body class="bg-body">
    <div class="container bg-body p-3">
      <div class="row">
        <div class="col-6 border rounded-3 bg-light bg-gradient">
          <div class="row p-3">
            <div class="col-3 p-1">
              <label for="multiplierRange" class="form-label">Loop Multiplier:</label>
            </div>
            <div class="col-9 p-1">
              <input type="range" class="form-range" min="0" max="20" step="0.0005" id="multiplierRange">
            </div>
          </div>
          <div class="row p-3">
            <div class="col-3 p-1">
              <label for="angleRange" class="form-label">Saturation Level:</label>
            </div>
            <div class="col-9 p-1">
              <input type="range" class="form-range" min="1" max="360" step="1" id="angleRange">
            </div>
          </div>
          <div class="row p-3">
            <div class="col-3 p-1">
              <label for="lineLengthRange" class="form-label">Line Length:</label>
            </div>
            <div class="col-9 p-1">
              <input type="range" class="form-range" min="0.01" max="3" step="0.01" id="lineLengthRange">
            </div>
          </div>
          <div class="row p-3">
            <div class="col-3 p-1">
            </div>
            <div class="col-9 p-1">
              <div id="multiplierRangeValue" aria-hidden="true"></div><br>
              <div id="angleRangeValue" aria-hidden="true"></div><br>
              <div id="lineLengthRangeValue" aria-hidden="true"></div><br>
              <div id="interationValue">Iteration: 0</div>
            </div>
          </div>
          <div class="row p-3">
            <div class="col-3 p-1">
            </div>
            <div class="col-9 p-1">
              <button id="startButton" class="col-2 btn btn-outline-primary">Start</button>
              <button id="stopButton" class="col-2 btn btn-outline-secondary">Stop</button>
            </div>
          </div>
          <div class="row p-3">
            <div class="col-3 p-1">
            </div>
            <div class="col-9 p-1">
              <ul>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-6 border rounded-3 bg-light bg-gradient">
          <canvas id="canvas" width="700" height="700"></canvas>
        </div>
      </div>
    </div>

    <script>

      // Collect initial objects
      const rangeInput = document.getElementById('multiplierRange');
      const rangeOutput = document.getElementById('multiplierRangeValue');

      const angleInput = document.getElementById('angleRange');
      const angleOutput = document.getElementById('angleRangeValue');

      const lineLengthInput = document.getElementById('lineLengthRange');
      const lineLengthOutput = document.getElementById('lineLengthRangeValue');

      const interationOutput = document.getElementById('interationValue');

      // Set initial values
      let loopInterval;
      let isLoopRunning = false;
      
      // Set initial output value
      rangeOutput.textContent = 'Loop Multiplier: ' + rangeInput.value;
      angleOutput.textContent = 'Saturation Level: ' + angleInput.value;
      lineLengthOutput.textContent = 'Line Length: ' + lineLengthInput.value;

      // Add range listener
      rangeInput.addEventListener('input', function() {
        rangeOutput.textContent = 'Loop Multiplier: ' + this.value;
        let dblMultiplier = parseFloat(this.value);
        let dblAngle = parseFloat(angleInput.value);
        let dblLineLength = parseFloat(lineLengthInput.value);
        draw(dblMultiplier, dblAngle, dblLineLength);
      });

      // Add angle / saturation listener
      angleInput.addEventListener('input', function() {
        angleOutput.textContent = 'Saturation Level: ' + this.value;
        let dblMultiplier = parseFloat(rangeInput.value);
        let dblAngle = parseFloat(this.value);
        let dblLineLength = parseFloat(lineLengthInput.value);
        draw(dblMultiplier, dblAngle, dblLineLength);
      });

      // Add line length listener
      lineLengthInput.addEventListener('input', function() {
        lineLengthOutput.textContent = 'Line Length: ' + this.value;
        let dblMultiplier = parseFloat(rangeInput.value);
        let dblAngle = parseFloat(angleInput.value);
        let dblLineLength = parseFloat(this.value);
        draw(dblMultiplier, dblAngle, dblLineLength);
      });

      // Define draw function
      function draw(dblMultiplier, dblAngleMax, dblLineLength) {

        const canvas = document.getElementById("canvas");
        
        if (canvas.getContext) {

          const ctx = canvas.getContext("2d");

          ctx.clearRect(0, 0, 700, 700);

          x1 = 0;
          y1 = 0;

          for (let dblAngle = 0; dblAngle <= dblAngleMax; 
            dblAngle = dblAngle + dblLineLength) {

            dblRadius = 600 * Math.cos(dblMultiplier*dblAngle);
            x2 = (((dblRadius * Math.sin(dblAngle))/Math.PI)*1.5) + 320;
            y2 = ((dblRadius * Math.cos(dblAngle))/2) + 320;

            if (x1 == 0) {
              x1 = x2;
              y1 = y2;
            };
      
            ctx.beginPath();  
            ctx.moveTo(x1,y1);
            ctx.lineTo(x2,y2);
            ctx.stroke();
            ctx.closePath();

            x1=x2;
            y1=y2;

          }

        }
      }

      // Define actions when start button clicked
      document.getElementById('startButton').addEventListener('click', () => {
        if (!isLoopRunning) {
          
          isLoopRunning = true;
          
          let count = 0;
          let dblIncrement = 0.0001;

          let dblMultiplier = parseFloat(rangeInput.value);
          let dblAngle = parseFloat(angleInput.value);
          let dblLineLength = parseFloat(lineLengthInput.value);

          loopInterval = setInterval(() => {

            interationOutput.textContent = `Iteration: ${count++}`;
            dblMultiplier = dblMultiplier + dblIncrement;

            if (dblMultiplier > 20) {dblMultiplier = 0};
            
            dblMultiplierFormated = dblMultiplier.toFixed(4);
            rangeInput.value = dblMultiplierFormated;
            rangeOutput.textContent = 'Loop Multiplier: ' + dblMultiplierFormated;

            dblLineLengthFormated = dblLineLength.toFixed(2);
            lineLengthInput.value = dblLineLengthFormated;
            lineLengthOutput.textContent = 'Line Length: ' + dblLineLengthFormated;

            draw(dblMultiplier, dblAngle, dblLineLength);

          }, 1);
        }
      });

      // Define actions when stop button clicked
      document.getElementById('stopButton').addEventListener('click', () => {
        if (isLoopRunning) {
          clearInterval(loopInterval);
          isLoopRunning = false;
          interationOutput.textContent = 'Iteration: Stopped';
        }
      });

      // Original Commodore 64 Code
      // 1 graphic 2 : b = 0.1
      // 10 c = 511 : d = 511
      // 20 for a=0 to 1000 step b
      // 30 r = 100 * cos (4*a)
      // 40 x = (r * sin(a))/3.14
      // 50 y = (r * cos(a))/2
      // 60 get a$ : if a$ > "" then 110
      // 70 x = x + 511 : y = y + 511
      // 80 draw 1,c,d to x,y
      // 90 d = y : c = x
      // 100 next a
      // 110 a = 1000
      // 120 b = b + .1
      // 130 scnclr
      // 140 goto 10

      // Loop Multiplier Notes:
      // 0 = full circle</li>
      // 1 = one loop
      // 2 = 4 loops
      // 3 = 3 loops
      // 4 = 8 loops
      // etc

    </script>

  </body>
</html>
